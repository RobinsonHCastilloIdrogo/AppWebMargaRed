<div class="modal-container">
  <!-- Header del modal -->
  <div class="modal-header">
    <h5 class="modal-title">Asignar para el {{ selectedDate }}</h5>
    <button type="button" class="close" (click)="modalRef.hide()">
      <span>&times;</span>
    </button>
  </div>

  <!-- Dropdown para seleccionar tipo de asignación en la parte superior -->
  <div class="modal-body">
    <div class="form-group full-width">
      <label for="assignmentType">Tipo de Asignación</label>
      <select
        class="form-control"
        id="assignmentType"
        [(ngModel)]="isEventSelected"
        (change)="onAssignmentTypeChange()"
      >
        <option [ngValue]="null">Seleccione un tipo de asignación</option>
        <option [ngValue]="true">Asignar Evento</option>
        <option [ngValue]="false">Asignar Proyecto</option>
      </select>
    </div>

    <!-- Contenedor de las dos columnas -->
    <div
      class="parent two-columns"
      [ngClass]="{ 'two-columns': employeeCount > 0 }"
    >
      <!-- Columna izquierda -->
      <div class="div1">
        <!-- Selecciona un Proyecto -->
        <div *ngIf="isEventSelected === false">
          <div class="form-group">
            <label>Selecciona un Proyecto</label>
            <select [(ngModel)]="selectedProject" class="form-control">
              <option value="">Selecciona un proyecto</option>
              <option *ngFor="let project of projects" [value]="project.id">
                {{ project.name }}
              </option>
            </select>
          </div>

          <!-- Cantidad de Empleados -->
          <div class="form-group">
            <label>Cantidad de Empleados</label>
            <input
              type="number"
              [(ngModel)]="employeeCount"
              (change)="generateEmployeeAssignments()"
              class="form-control"
              placeholder="Ingrese la cantidad de empleados"
              min="1"
            />
          </div>

          <!-- Descripción del Proyecto -->
          <div class="form-group">
            <label>Descripción del Proyecto</label>
            <textarea
              [(ngModel)]="descripcionProyecto"
              class="form-control"
              rows="3"
              placeholder="Descripción del proyecto"
            ></textarea>
          </div>
        </div>
      </div>

      <!-- Columna derecha: visible solo cuando employeeCount > 0 -->
      <div class="div2" *ngIf="isEventSelected === false && employeeCount > 0">
        <!-- Dropdown para seleccionar empleado -->
        <div class="form-group" *ngIf="projectAssignments.length > 0">
          <label>Seleccione un Empleado</label>
          <select
            [(ngModel)]="selectedAssignmentIndex"
            (change)="selectEmployeeAssignment()"
            class="form-control"
          >
            <option
              *ngFor="let assignment of projectAssignments; let i = index"
              [ngValue]="i"
            >
              Empleado {{ i + 1 }}
            </option>
          </select>
        </div>

        <!-- Formulario para la asignación de un empleado seleccionado -->
        <div *ngIf="selectedAssignment">
          <div class="form-group">
            <label>Empleado</label>
            <select
              [(ngModel)]="selectedAssignment.employeeId"
              (change)="
                selectedAssignment.employeeName = getEmployeeName(
                  selectedAssignment.employeeId!
                )
              "
              class="form-control"
            >
              <option value="">Selecciona un empleado</option>
              <option *ngFor="let emp of employees" [value]="emp.id">
                {{ emp.name }}
              </option>
            </select>
          </div>

          <!-- Seleccionar Rol (Operador u Obrero) -->
          <div class="form-group">
            <label>Rol</label>
            <select
              [(ngModel)]="selectedAssignment.role"
              (change)="
                updateAssignmentRole(
                  selectedAssignmentIndex!,
                  selectedAssignment.role
                )
              "
              class="form-control"
            >
              <option value="Operador">Operador (con máquina)</option>
              <option value="Obrero">Obrero (sin máquina)</option>
            </select>
          </div>

          <!-- Seleccionar Maquinaria (si es Operador) -->
          <div
            *ngIf="selectedAssignment.role === 'Operador'"
            class="form-group"
          >
            <label>Maquinaria</label>
            <select
              [(ngModel)]="selectedAssignment.machineId"
              (change)="
                selectedAssignment.machineName = getMachineName(
                  selectedAssignment.machineId!
                )
              "
              class="form-control"
            >
              <option value="">Selecciona una maquinaria</option>
              <option *ngFor="let maq of machines" [value]="maq.id">
                {{ maq.name }}
              </option>
            </select>
          </div>

          <!-- Horario de inicio y fin -->
          <div class="row">
            <div class="col-6">
              <label>Hora Inicio</label>
              <input
                type="time"
                [(ngModel)]="selectedAssignment.startHour"
                class="form-control"
              />
            </div>
            <div class="col-6">
              <label>Hora Fin</label>
              <input
                type="time"
                [(ngModel)]="selectedAssignment.endHour"
                class="form-control"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer del modal -->
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modalRef.hide()">
      Cancelar
    </button>
    <button
      type="button"
      class="btn btn-primary"
      (click)="guardarAsignacion()"
      [disabled]="isEventSelected === null"
    >
      Guardar
    </button>
  </div>
</div>
